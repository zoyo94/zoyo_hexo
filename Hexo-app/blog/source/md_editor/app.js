const a0_0x50bad5=a0_0x1515;(function(_0x55077f,_0x46c6e5){const _0xc31059=a0_0x1515,_0x2ef6e9=_0x55077f();while(!![]){try{const _0x2d56eb=-parseInt(_0xc31059(0x1f8))/0x1*(-parseInt(_0xc31059(0x1ed))/0x2)+parseInt(_0xc31059(0x1fd))/0x3+parseInt(_0xc31059(0x200))/0x4+-parseInt(_0xc31059(0x1db))/0x5+parseInt(_0xc31059(0x215))/0x6*(-parseInt(_0xc31059(0x1bb))/0x7)+parseInt(_0xc31059(0x1ff))/0x8*(parseInt(_0xc31059(0x1fb))/0x9)+-parseInt(_0xc31059(0x21c))/0xa;if(_0x2d56eb===_0x46c6e5)break;else _0x2ef6e9['push'](_0x2ef6e9['shift']());}catch(_0x4641cb){_0x2ef6e9['push'](_0x2ef6e9['shift']());}}}(a0_0x42f4,0x5c20e));const express=require(a0_0x50bad5(0x229)),multer=require(a0_0x50bad5(0x227)),fs=require('fs'),path=require('path'),cors=require(a0_0x50bad5(0x1ea)),tar=require(a0_0x50bad5(0x1cd)),winston=require(a0_0x50bad5(0x1bd)),CONFIG={'WORK_DIR':path[a0_0x50bad5(0x20d)](__dirname,a0_0x50bad5(0x22e),a0_0x50bad5(0x206)),'PORT':0xbb9,'MD_FILE_SIZE_LIMIT':0x5*0x400*0x400,'IMG_FILE_SIZE_LIMIT':0x32*0x400*0x400};process[a0_0x50bad5(0x235)](CONFIG[a0_0x50bad5(0x1c0)]);const app=express();app[a0_0x50bad5(0x233)](cors()),app[a0_0x50bad5(0x233)](express[a0_0x50bad5(0x1c4)]({'type':a0_0x50bad5(0x214),'charset':'utf-8'}));const logger=winston['createLogger']({'level':'info','format':winston[a0_0x50bad5(0x22d)][a0_0x50bad5(0x1ce)](winston[a0_0x50bad5(0x22d)][a0_0x50bad5(0x1c9)](),winston[a0_0x50bad5(0x22d)][a0_0x50bad5(0x1c4)]()),'transports':[new winston[(a0_0x50bad5(0x1d7))]['File']({'filename':path[a0_0x50bad5(0x20d)](__dirname,'error.log'),'level':a0_0x50bad5(0x1e2)}),new winston[(a0_0x50bad5(0x1d7))]['File']({'filename':path['join'](__dirname,a0_0x50bad5(0x216))})]});function a0_0x42f4(){const _0x5eed8e=['none','basename','Saved\x20MD\x20file:\x20','error','PORT','文件夹上传成功','status','Moved\x20','mkdirSync','Uploaded\x20file:\x20','image','cors','binary','finish','2avOYdZ','memoryStorage','resolve','files','listen','导出失败','relative','\x20to\x20','buffer','md_file','createReadStream','8631bYWIUO','createWriteStream','length','756099rwZPpi','未上传文件','436176LuijAP','info','40PYyuvO','1539944xqPSHj','文件写入成功❤️','utf8','push','/tgz_download','文件夹\x20','uploads','\x20从\x20','/directory-tree','缺少目录参数','production','MD\x20文件上传成功','pipe','join','post','file','then','stat','\x20from\x20','unlink','application/json','78cWlltB','combined.log','test','promises','create','attachment;\x20filename=\x22','existsSync','2327510AuWkre','Created\x20directory:\x20','\x22;\x20filename*=UTF-8\x27\x27','dirname','add','\x20移动至\x20','toLowerCase','图片上传成功❤️','get','Export\x20failed:\x20','rename','multer','/move_image','express','name','/upload-folder','Console','format','public','Content-Length','destination','set','服务已启动，监听端口\x20','use','directory','chdir','缺少必要参数','Exported:\x20','catch','mkdir','154735KTjIVi','body','winston','toString','\x20不存在','WORK_DIR','上传的文件必须为\x20.md\x20格式','/create_folder','originalname','json','from','writeFile','folderName','Uploaded\x20MD\x20file:\x20','timestamp','single','application/octet-stream','目录创建成功❤️','tar','combine','/upload','.tar','replace','缺少必要参数或文件','Failed\x20to\x20delete\x20temp\x20file:\x20','/upimg','图片移动成功❤️，已将\x20','目录已存在','transports','extname','message','env','307950qNPdcX','MD_FILE_SIZE_LIMIT','temp-','map'];a0_0x42f4=function(){return _0x5eed8e;};return a0_0x42f4();}process[a0_0x50bad5(0x1da)]['NODE_ENV']!==a0_0x50bad5(0x20a)&&logger[a0_0x50bad5(0x220)](new winston[(a0_0x50bad5(0x1d7))][(a0_0x50bad5(0x22c))]({'format':winston['format']['simple']()}));function a0_0x1515(_0x5b2a8c,_0x36fd97){const _0x42f43b=a0_0x42f4();return a0_0x1515=function(_0x15150b,_0x2fedc9){_0x15150b=_0x15150b-0x1b8;let _0x571a69=_0x42f43b[_0x15150b];return _0x571a69;},a0_0x1515(_0x5b2a8c,_0x36fd97);}const createMulter=(_0x17bf9d,_0x10e18c)=>multer({'storage':multer[a0_0x50bad5(0x1ee)](),'limits':{'fileSize':_0x17bf9d},'fileFilter':_0x10e18c}),uploadMd=createMulter(CONFIG[a0_0x50bad5(0x1dc)],(_0x3df5e2,_0x22ae76,_0x452f41)=>{const _0x4d7792=a0_0x50bad5,_0x4a370b=/md/,_0x16eb6a=_0x4a370b[_0x4d7792(0x217)](path[_0x4d7792(0x1d8)](_0x22ae76[_0x4d7792(0x1c3)])[_0x4d7792(0x222)]());_0x16eb6a?_0x452f41(null,!![]):_0x452f41(new Error(_0x4d7792(0x1c1)));}),uploadImg=createMulter(CONFIG['IMG_FILE_SIZE_LIMIT']),noFileUpload=createMulter(),writeFile=(_0x4c4b7c,_0x491265)=>new Promise((_0x56105f,_0x46944f)=>{const _0x53b1b0=a0_0x50bad5;fs[_0x53b1b0(0x1c6)](_0x4c4b7c,_0x491265,_0x29dbed=>{_0x29dbed?_0x46944f(_0x29dbed):_0x56105f();});}),readDirectory=_0x1427ac=>new Promise((_0x9f0052,_0x1d712a)=>{const _0x334a0f=a0_0x50bad5;fs['readdir'](_0x1427ac,{'withFileTypes':!![],'encoding':_0x334a0f(0x202)},(_0x37f081,_0x42c323)=>{const _0x4e7486=_0x334a0f;if(_0x37f081)return _0x1d712a(_0x37f081);const _0x3423af=_0x42c323[_0x4e7486(0x1de)](_0x5cbd8a=>{const _0xebc44f=_0x4e7486,_0x3802c4=path[_0xebc44f(0x20d)](_0x1427ac,_0x5cbd8a['name']);return _0x5cbd8a['isDirectory']()?readDirectory(_0x3802c4)[_0xebc44f(0x210)](_0x4d0a0e=>({'name':_0x5cbd8a[_0xebc44f(0x22a)],'children':_0x4d0a0e,'type':_0xebc44f(0x234)})):Promise[_0xebc44f(0x1ef)]({'name':_0x5cbd8a[_0xebc44f(0x22a)],'type':'file'});});Promise['all'](_0x3423af)[_0x4e7486(0x210)](_0x3c5865=>_0x9f0052({'name':path[_0x4e7486(0x1e0)](_0x1427ac),'children':_0x3c5865}))[_0x4e7486(0x1b9)](_0x1d712a);});}),getRelativePath=_0x15f3c2=>path[a0_0x50bad5(0x1f3)](__dirname,_0x15f3c2),errorHandler=(_0x3ecd05,_0x4a57a5,_0x5c12b9,_0x45dc90)=>{const _0x5b7f4f=a0_0x50bad5;logger[_0x5b7f4f(0x1e2)]('Error:\x20'+_0x3ecd05[_0x5b7f4f(0x1d9)]),_0x5c12b9[_0x5b7f4f(0x1e5)](0x1f4)[_0x5b7f4f(0x1c4)]({'success':![],'message':_0x3ecd05[_0x5b7f4f(0x1d9)]||'服务器错误'});};app[a0_0x50bad5(0x20e)](a0_0x50bad5(0x1cf),uploadMd[a0_0x50bad5(0x1ca)](a0_0x50bad5(0x1f6)),async(_0xc41ecb,_0x4b9ae6,_0x44bee3)=>{const _0x1a97f4=a0_0x50bad5;try{if(!_0xc41ecb['file'])throw new Error(_0x1a97f4(0x1fc));const _0x5c511a=Buffer[_0x1a97f4(0x1c5)](_0xc41ecb[_0x1a97f4(0x20f)]['originalname'],_0x1a97f4(0x1eb))[_0x1a97f4(0x1be)](_0x1a97f4(0x202)),_0x2d001e=path[_0x1a97f4(0x20d)](CONFIG[_0x1a97f4(0x1c0)],_0x5c511a);await writeFile(_0x2d001e,_0xc41ecb[_0x1a97f4(0x20f)][_0x1a97f4(0x1f5)]),logger[_0x1a97f4(0x1fe)](_0x1a97f4(0x1c8)+getRelativePath(_0x2d001e)),_0x4b9ae6['json']({'success':!![],'message':_0x1a97f4(0x20b),'filePath':_0x2d001e,'filename':_0x5c511a,'destination':'./'});}catch(_0x318dc9){_0x44bee3(_0x318dc9);}}),app['post'](a0_0x50bad5(0x1d4),uploadImg['array'](a0_0x50bad5(0x1e9)),async(_0x547905,_0x2c04aa,_0x38fb94)=>{const _0x15e0c=a0_0x50bad5;try{const _0x4108d7=_0x547905['body'][_0x15e0c(0x230)]||'./',_0x3c6466=path[_0x15e0c(0x20d)](CONFIG[_0x15e0c(0x1c0)],_0x4108d7[_0x15e0c(0x1d1)](/^\.\//,'')),_0x5d672a=[],_0x344905=[];!fs['existsSync'](_0x3c6466)&&(await fs[_0x15e0c(0x218)][_0x15e0c(0x1ba)](_0x3c6466,{'recursive':!![]}),logger[_0x15e0c(0x1fe)](_0x15e0c(0x21d)+getRelativePath(_0x3c6466)));for(const _0xfe657 of _0x547905[_0x15e0c(0x1f0)]){const _0x339e2c=Buffer[_0x15e0c(0x1c5)](_0xfe657['originalname'],_0x15e0c(0x1eb))[_0x15e0c(0x1be)]('utf8'),_0x322bfe=path[_0x15e0c(0x20d)](_0x3c6466,_0x339e2c);await writeFile(_0x322bfe,_0xfe657[_0x15e0c(0x1f5)]),_0x5d672a[_0x15e0c(0x203)](''+_0x4108d7+_0x339e2c),_0x344905[_0x15e0c(0x203)](_0x339e2c),logger[_0x15e0c(0x1fe)]('Uploaded\x20image:\x20'+getRelativePath(_0x322bfe)+_0x15e0c(0x1f4)+_0x4108d7);}_0x2c04aa['json']({'success':!![],'message':_0x15e0c(0x223),'imagePaths':_0x5d672a,'filenames':_0x344905,'destination':_0x4108d7});}catch(_0x27793c){_0x38fb94(_0x27793c);}}),app['post'](a0_0x50bad5(0x22b),uploadImg['array'](a0_0x50bad5(0x1f0)),async(_0xb45648,_0x69c26e,_0x41fb49)=>{const _0x43c580=a0_0x50bad5;try{const _0x45a1f7=_0xb45648['body'][_0x43c580(0x1c7)];if(!_0x45a1f7||!_0xb45648[_0x43c580(0x1f0)]||_0xb45648['files'][_0x43c580(0x1fa)]===0x0)throw new Error(_0x43c580(0x1d2));const _0x155a79=[],_0x4caa52=[];for(const _0x26543a of _0xb45648[_0x43c580(0x1f0)]){const _0x137b63=Buffer[_0x43c580(0x1c5)](_0x26543a[_0x43c580(0x1c3)],_0x43c580(0x1eb))[_0x43c580(0x1be)]('utf8');console['log'](_0x26543a[_0x43c580(0x1c3)],_0x137b63);const _0x477aa5=path['join'](CONFIG[_0x43c580(0x1c0)],_0x45a1f7,_0x137b63),_0x241af8=path[_0x43c580(0x21f)](_0x477aa5);!fs[_0x43c580(0x21b)](_0x241af8)&&(fs[_0x43c580(0x1e7)](_0x241af8,{'recursive':!![]}),logger['info'](_0x43c580(0x21d)+getRelativePath(_0x241af8))),await writeFile(_0x477aa5,_0x26543a[_0x43c580(0x1f5)]),_0x155a79[_0x43c580(0x203)](_0x45a1f7+'/'+_0x137b63),_0x4caa52[_0x43c580(0x203)](_0x137b63),logger[_0x43c580(0x1fe)](_0x43c580(0x1e8)+getRelativePath(_0x477aa5)+'\x20to\x20'+_0x45a1f7);}_0x69c26e[_0x43c580(0x1c4)]({'success':!![],'message':_0x43c580(0x1e4),'filePaths':_0x155a79,'filenames':_0x4caa52,'destination':'./'+_0x45a1f7+'/'});}catch(_0x513db3){_0x41fb49(_0x513db3);}}),app[a0_0x50bad5(0x224)](a0_0x50bad5(0x208),async(_0x145c4c,_0x2370ea,_0x460853)=>{const _0x427e03=a0_0x50bad5;try{const _0x478ed4=_0x145c4c['query'][_0x427e03(0x234)];if(!_0x478ed4)throw new Error('缺少目录参数');const _0x590569=await readDirectory(_0x478ed4);logger[_0x427e03(0x1fe)]('Fetched\x20directory\x20tree\x20for:\x20'+getRelativePath(_0x478ed4)),_0x2370ea[_0x427e03(0x1c4)](_0x590569);}catch(_0x225b0e){_0x460853(_0x225b0e);}}),app['post']('/save_md',noFileUpload[a0_0x50bad5(0x1ca)]('file'),async(_0x33eee0,_0x1b087b,_0x1db872)=>{const _0x4750e5=a0_0x50bad5;try{const {destination:_0xcfd414,filename:_0x2fece8,currentContent:_0x3561a3}=_0x33eee0[_0x4750e5(0x1bc)];if(!_0xcfd414||!_0x2fece8||!_0x3561a3)throw new Error('缺少必要参数');const _0x29e885=path[_0x4750e5(0x20d)](CONFIG[_0x4750e5(0x1c0)],_0xcfd414[_0x4750e5(0x1d1)](/^\.\//,''),_0x2fece8);await writeFile(_0x29e885,_0x3561a3),logger[_0x4750e5(0x1fe)](_0x4750e5(0x1e1)+getRelativePath(_0x29e885)+_0x4750e5(0x1f4)+_0xcfd414),_0x1b087b[_0x4750e5(0x1c4)]({'success':!![],'message':_0x4750e5(0x201),'filepath':_0x2fece8});}catch(_0x365786){_0x1db872(_0x365786);}}),app[a0_0x50bad5(0x20e)](a0_0x50bad5(0x1c2),noFileUpload[a0_0x50bad5(0x1ca)]('file'),async(_0xb48027,_0x12b223,_0x38b7ac)=>{const _0x3a9097=a0_0x50bad5;try{const {folderPath:_0x4c6231,folderName:_0x2f3346}=_0xb48027['body'];if(!_0x4c6231||!_0x2f3346)throw new Error(_0x3a9097(0x209));const _0x4dda82=path[_0x3a9097(0x20d)](CONFIG[_0x3a9097(0x1c0)],_0x4c6231[_0x3a9097(0x1d1)](/^\.\//,''),_0x2f3346);if(fs[_0x3a9097(0x21b)](_0x4dda82))throw new Error(_0x3a9097(0x1d6));await fs[_0x3a9097(0x218)][_0x3a9097(0x1ba)](_0x4dda82),logger['info']('Created\x20folder:\x20'+getRelativePath(_0x4dda82)),_0x12b223[_0x3a9097(0x1c4)]({'success':!![],'message':_0x3a9097(0x1cc),'folderpath':'./'+_0x2f3346+'/'});}catch(_0x17ed44){_0x38b7ac(_0x17ed44);}}),app['post'](a0_0x50bad5(0x228),noFileUpload[a0_0x50bad5(0x1ca)](a0_0x50bad5(0x20f)),async(_0x4dec36,_0x462ee7,_0x21d722)=>{const _0x506a5f=a0_0x50bad5;try{const {folderName:_0x518f2b,fileName:_0x3c863d,new_folderName:_0x3c71eb,original_dir:_0x123674}=_0x4dec36[_0x506a5f(0x1bc)];if(!_0x518f2b||!_0x3c863d||!_0x3c71eb||!_0x123674)throw new Error(_0x506a5f(0x236));const _0x503c81=path[_0x506a5f(0x20d)](CONFIG[_0x506a5f(0x1c0)],_0x518f2b,_0x3c863d),_0x590081=path[_0x506a5f(0x20d)](CONFIG[_0x506a5f(0x1c0)],_0x3c71eb,_0x3c863d);!fs[_0x506a5f(0x21b)](path[_0x506a5f(0x21f)](_0x590081))&&(await fs[_0x506a5f(0x218)][_0x506a5f(0x1ba)](path[_0x506a5f(0x21f)](_0x590081),{'recursive':!![]}),logger[_0x506a5f(0x1fe)](_0x506a5f(0x21d)+getRelativePath(path[_0x506a5f(0x21f)](_0x590081)))),await fs[_0x506a5f(0x218)][_0x506a5f(0x226)](_0x503c81,_0x590081),logger[_0x506a5f(0x1fe)](_0x506a5f(0x1e6)+_0x3c863d+_0x506a5f(0x212)+_0x518f2b+_0x506a5f(0x1f4)+_0x3c71eb),_0x462ee7[_0x506a5f(0x1c4)]({'success':!![],'message':_0x506a5f(0x1d5)+_0x3c863d+_0x506a5f(0x207)+_0x518f2b+_0x506a5f(0x221)+_0x3c71eb,'data':{'original_dir':_0x123674,'folderName':_0x518f2b,'fileName':_0x3c863d,'new_folderName':_0x3c71eb}});}catch(_0x869f44){_0x21d722(_0x869f44);}}),app[a0_0x50bad5(0x20e)](a0_0x50bad5(0x204),noFileUpload[a0_0x50bad5(0x1df)](),async(_0x3d9adf,_0x98f405,_0x132179)=>{const _0x35780d=a0_0x50bad5;try{const {directoryName:_0x534fe4,selectedFile:_0x2775e9,original_dir:_0x2435f2,markdownContent:_0x61a294}=_0x3d9adf['body'];if(!_0x534fe4||!_0x2435f2)throw new Error('缺少必要参数:\x20directoryName\x20或\x20original_dir');const _0x1a6943=_0x534fe4+_0x35780d(0x1d0),_0x3ff5d5=path[_0x35780d(0x20d)](CONFIG['WORK_DIR'],_0x534fe4);if(!fs[_0x35780d(0x21b)](_0x3ff5d5))throw new Error(_0x35780d(0x205)+_0x534fe4+_0x35780d(0x1bf));const _0x1ccf68=encodeURIComponent(_0x1a6943),_0x3106d0=_0x1a6943[_0x35780d(0x1d1)](/[^a-zA-Z0-9.-]/g,'_');_0x98f405[_0x35780d(0x231)]('Content-Type',_0x35780d(0x1cb)),_0x98f405[_0x35780d(0x231)]('Content-Disposition',_0x35780d(0x21a)+_0x3106d0+_0x35780d(0x21e)+_0x1ccf68);const _0x531d4d=_0x2775e9&&/!\[.*?\]\([^)]+\)/[_0x35780d(0x217)](_0x61a294)?[_0x534fe4,_0x2775e9]:_0x2775e9?[_0x2775e9]:[_0x534fe4],_0xb22c45=tar[_0x35780d(0x219)]({'gzip':!![]},_0x531d4d),_0xe42c14=path[_0x35780d(0x20d)](CONFIG[_0x35780d(0x1c0)],_0x35780d(0x1dd)+_0x1a6943);await new Promise((_0x3f6726,_0x2573f2)=>{const _0xf17fd4=_0x35780d,_0x1bcbb6=fs[_0xf17fd4(0x1f9)](_0xe42c14);_0xb22c45[_0xf17fd4(0x20c)](_0x1bcbb6),_0x1bcbb6['on'](_0xf17fd4(0x1ec),_0x3f6726),_0x1bcbb6['on'](_0xf17fd4(0x1e2),_0x2573f2);});const _0x2c4b37=await fs[_0x35780d(0x218)][_0x35780d(0x211)](_0xe42c14);_0x98f405[_0x35780d(0x231)](_0x35780d(0x22f),_0x2c4b37['size']),fs[_0x35780d(0x1f7)](_0xe42c14)[_0x35780d(0x20c)](_0x98f405),fs[_0x35780d(0x213)](_0xe42c14,_0x81d7c3=>{const _0x27b647=_0x35780d;if(_0x81d7c3)logger[_0x27b647(0x1e2)](_0x27b647(0x1d3)+_0x81d7c3['message']);}),logger['info'](_0x35780d(0x1b8)+_0x531d4d[_0x35780d(0x20d)](',\x20')+'\x20as\x20'+_0x1a6943);}catch(_0x5e5501){logger[_0x35780d(0x1e2)](_0x35780d(0x225)+_0x5e5501[_0x35780d(0x1d9)]),_0x98f405[_0x35780d(0x1e5)](0x1f4)[_0x35780d(0x1c4)]({'success':![],'message':_0x5e5501['message']||_0x35780d(0x1f2)});}}),app[a0_0x50bad5(0x233)](errorHandler),app[a0_0x50bad5(0x1f1)](CONFIG[a0_0x50bad5(0x1e3)],()=>{const _0x54e862=a0_0x50bad5;logger[_0x54e862(0x1fe)](_0x54e862(0x232)+CONFIG[_0x54e862(0x1e3)]);});