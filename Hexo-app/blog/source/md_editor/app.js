function a0_0xf23e(){const _0x3a5ca1=['目录创建成功❤️','toString','/move_image','isDirectory','文件夹\x20','lastIndexOf','已将\x20','application/octet-stream','图片移动成功❤️，已将\x20','substring','Content-Type','服务已启动，监听端口\x20','map','/upload','md_editor/public/uploads/','body','未上传文件','2242870KvYWGu','1189698yCHRNi','WORK_DIR','上传的文件必须为\x20.md\x20格式','uploads','use','set','缺少必要参数','661420gcNzbQ','get','602PpBWCC','directory','name','MD_FILE_SIZE_LIMIT','buffer','query','resolve','create','文件\x20','all','join','36786vpgaPI','md_file','服务器错误','IMG_FILE_SIZE_LIMIT','binary','toLowerCase','8365024ukZuZx','目录已存在','\x20不存在','destination','existsSync','\x20移动至\x20','rename','post','/directory-tree','readdir','originalname','MD\x20文件上传成功','图片上传成功❤️','mkdir','then','log','memoryStorage','single','dirname','cors','replace','express','/save_md','basename','push','message','1815762CAOESO','extname','image','test','file','array','3662620hYolSW','chdir','json','/create_folder','promises','.tar','PORT','catch','from'];a0_0xf23e=function(){return _0x3a5ca1;};return a0_0xf23e();}const a0_0x35237b=a0_0x24f4;(function(_0x3a8479,_0x380870){const _0x3c685b=a0_0x24f4,_0x3df61f=_0x3a8479();while(!![]){try{const _0x1a6d58=parseInt(_0x3c685b(0x151))/0x1+-parseInt(_0x3c685b(0x14a))/0x2+parseInt(_0x3c685b(0x129))/0x3+parseInt(_0x3c685b(0x12f))/0x4+parseInt(_0x3c685b(0x149))/0x5+parseInt(_0x3c685b(0x15e))/0x6*(-parseInt(_0x3c685b(0x153))/0x7)+-parseInt(_0x3c685b(0x164))/0x8;if(_0x1a6d58===_0x380870)break;else _0x3df61f['push'](_0x3df61f['shift']());}catch(_0x13a567){_0x3df61f['push'](_0x3df61f['shift']());}}}(a0_0xf23e,0x71138));function a0_0x24f4(_0x5ea3cc,_0x52c815){const _0xf23ebf=a0_0xf23e();return a0_0x24f4=function(_0x24f4b0,_0x37ac7e){_0x24f4b0=_0x24f4b0-0x110;let _0x547308=_0xf23ebf[_0x24f4b0];return _0x547308;},a0_0x24f4(_0x5ea3cc,_0x52c815);}const express=require(a0_0x35237b(0x124)),multer=require('multer'),fs=require('fs'),path=require('path'),cors=require(a0_0x35237b(0x122)),tar=require('tar'),CONFIG={'WORK_DIR':path['join'](__dirname,'public',a0_0x35237b(0x14d)),'PORT':0xbb9,'MD_FILE_SIZE_LIMIT':0x5*0x400*0x400,'IMG_FILE_SIZE_LIMIT':0x32*0x400*0x400};process[a0_0x35237b(0x130)](CONFIG[a0_0x35237b(0x14b)]);const app=express();app[a0_0x35237b(0x14e)](cors());const createMulter=(_0x514e2f,_0x4fb39d)=>multer({'storage':multer[a0_0x35237b(0x11f)](),'limits':{'fileSize':_0x514e2f},'fileFilter':_0x4fb39d}),uploadMd=createMulter(CONFIG[a0_0x35237b(0x156)],(_0x216602,_0x33795e,_0x5c8158)=>{const _0x48f9d3=a0_0x35237b,_0x4fb52f=/md/,_0x1b50ad=_0x4fb52f[_0x48f9d3(0x12c)](path[_0x48f9d3(0x12a)](_0x33795e[_0x48f9d3(0x119)])[_0x48f9d3(0x163)]());_0x1b50ad?_0x5c8158(null,!![]):_0x5c8158(new Error(_0x48f9d3(0x14c)));}),uploadImg=createMulter(CONFIG[a0_0x35237b(0x161)]),noFileUpload=createMulter(),normalizeFilename=_0x29c7ee=>{const _0x3503f7=a0_0x35237b;let _0x2710b3=Buffer[_0x3503f7(0x137)](_0x29c7ee,_0x3503f7(0x162))[_0x3503f7(0x139)]('utf-8')[_0x3503f7(0x123)](/\s/g,'_');const _0x3a3c18=_0x2710b3[_0x3503f7(0x13d)]('.');if(_0x3a3c18>0x0){const _0x5181e2=_0x2710b3[_0x3503f7(0x141)](0x0,_0x3a3c18)[_0x3503f7(0x123)](/\./g,'_'),_0x5ae249=_0x2710b3['substring'](_0x3a3c18);_0x2710b3=''+_0x5181e2+_0x5ae249;}return _0x2710b3;},writeFile=(_0x342360,_0x1b0272)=>new Promise((_0x932318,_0x51fc8a)=>{fs['writeFile'](_0x342360,_0x1b0272,_0x4c1815=>{_0x4c1815?_0x51fc8a(_0x4c1815):_0x932318();});}),readDirectory=_0x4af8d8=>new Promise((_0x213b03,_0x3d78b5)=>{const _0x216505=a0_0x35237b;fs[_0x216505(0x118)](_0x4af8d8,{'withFileTypes':!![]},(_0x244f23,_0x37208d)=>{const _0x45b749=_0x216505;if(_0x244f23)return _0x3d78b5(_0x244f23);const _0x1402f2=_0x37208d[_0x45b749(0x144)](_0x9831b4=>{const _0x114ea5=_0x45b749,_0x132dc1=path[_0x114ea5(0x15d)](_0x4af8d8,_0x9831b4[_0x114ea5(0x155)]);return _0x9831b4[_0x114ea5(0x13b)]()?readDirectory(_0x132dc1)[_0x114ea5(0x11d)](_0x3bf01e=>({'name':_0x9831b4[_0x114ea5(0x155)],'children':_0x3bf01e,'type':_0x114ea5(0x154)})):Promise[_0x114ea5(0x159)]({'name':_0x9831b4[_0x114ea5(0x155)],'type':_0x114ea5(0x12d)});});Promise[_0x45b749(0x15c)](_0x1402f2)[_0x45b749(0x11d)](_0x2a10fa=>_0x213b03({'name':path[_0x45b749(0x126)](_0x4af8d8),'children':_0x2a10fa}))[_0x45b749(0x136)](_0x3d78b5);});}),errorHandler=(_0x466f32,_0x549c0b,_0x365abd,_0x1cd4f6)=>{const _0x29f46a=a0_0x35237b;console['error'](_0x466f32),_0x365abd['status'](0x1f4)[_0x29f46a(0x131)]({'success':![],'message':_0x466f32[_0x29f46a(0x128)]||_0x29f46a(0x160)});};app[a0_0x35237b(0x116)](a0_0x35237b(0x145),uploadMd['single'](a0_0x35237b(0x15f)),async(_0x382681,_0x31bde8,_0x2c473c)=>{const _0x189c89=a0_0x35237b;try{if(!_0x382681[_0x189c89(0x12d)])throw new Error(_0x189c89(0x148));const _0x42d6fd=normalizeFilename(_0x382681[_0x189c89(0x12d)][_0x189c89(0x119)]),_0x6e5f53=path['join'](CONFIG[_0x189c89(0x14b)],_0x42d6fd);await writeFile(_0x6e5f53,_0x382681[_0x189c89(0x12d)]['buffer']),_0x31bde8[_0x189c89(0x131)]({'success':!![],'message':_0x189c89(0x11a),'filePath':_0x6e5f53,'filename':_0x42d6fd,'destination':_0x189c89(0x146)});}catch(_0x434df6){_0x2c473c(_0x434df6);}}),app['post']('/upimg',uploadImg[a0_0x35237b(0x12e)](a0_0x35237b(0x12b)),async(_0x3212c8,_0x1186cd,_0x3d61c1)=>{const _0x5e30a7=a0_0x35237b;try{const _0x3ffc12=_0x3212c8['body'][_0x5e30a7(0x112)]||CONFIG[_0x5e30a7(0x14b)],_0x528f82=[],_0x8cbdf8=[];for(const _0x1c0a57 of _0x3212c8['files']){const _0x2c6674=normalizeFilename(_0x1c0a57[_0x5e30a7(0x119)]),_0x352265=path[_0x5e30a7(0x15d)](_0x3ffc12,_0x2c6674);await writeFile(_0x352265,_0x1c0a57[_0x5e30a7(0x157)]),_0x528f82[_0x5e30a7(0x127)](_0x352265),_0x8cbdf8[_0x5e30a7(0x127)](_0x2c6674);}_0x1186cd[_0x5e30a7(0x131)]({'success':!![],'message':_0x5e30a7(0x11b),'imagePaths':_0x528f82,'filenames':_0x8cbdf8,'destination':_0x3ffc12});}catch(_0x309cf3){_0x3d61c1(_0x309cf3);}}),app['get'](a0_0x35237b(0x117),async(_0x14340f,_0x50de47,_0xe54da)=>{const _0x3e049f=a0_0x35237b;try{const _0x2ac64b=_0x14340f[_0x3e049f(0x158)]['directory'];if(!_0x2ac64b)throw new Error('缺少目录参数');const _0x249036=await readDirectory(_0x2ac64b);_0x50de47['json'](_0x249036);}catch(_0x164b81){_0xe54da(_0x164b81);}}),app[a0_0x35237b(0x116)](a0_0x35237b(0x125),noFileUpload[a0_0x35237b(0x120)](a0_0x35237b(0x12d)),async(_0x3fad5b,_0x3da8b6,_0x1d3585)=>{const _0x2a8f23=a0_0x35237b;try{const {destination:_0x135095,filename:_0x5a9154,currentContent:_0x300625}=_0x3fad5b['body'];if(!_0x135095||!_0x5a9154||!_0x300625)throw new Error(_0x2a8f23(0x150));const _0x48ceac=decodeURIComponent(_0x5a9154),_0x1f85c7=path[_0x2a8f23(0x15d)](_0x135095,_0x48ceac);await writeFile(_0x1f85c7,_0x300625),_0x3da8b6[_0x2a8f23(0x131)]({'success':!![],'message':'文件写入成功❤️','filepath':_0x48ceac});}catch(_0x311a91){_0x1d3585(_0x311a91);}}),app[a0_0x35237b(0x116)](a0_0x35237b(0x132),noFileUpload[a0_0x35237b(0x120)](a0_0x35237b(0x12d)),async(_0x16733f,_0x3eeafe,_0x268fb2)=>{const _0x2f3c54=a0_0x35237b;try{const {folderPath:_0x278573,folderName:_0xb02868}=_0x16733f[_0x2f3c54(0x147)];if(!_0x278573||!_0xb02868)throw new Error('缺少目录参数');const _0x2db805=path['join'](_0x278573,_0xb02868);if(fs[_0x2f3c54(0x113)](_0x2db805))throw new Error(_0x2f3c54(0x110));await fs[_0x2f3c54(0x133)][_0x2f3c54(0x11c)](_0x2db805),_0x3eeafe['json']({'success':!![],'message':_0x2f3c54(0x138),'folderpath':_0x2db805});}catch(_0x1594f7){_0x268fb2(_0x1594f7);}}),app[a0_0x35237b(0x116)](a0_0x35237b(0x13a),noFileUpload[a0_0x35237b(0x120)]('file'),async(_0x57dec7,_0x3c4305,_0x12934b)=>{const _0x2f38a7=a0_0x35237b;try{const {folderName:_0x3696ff,fileName:_0x2882f4,new_folderName:_0x1b05b9,original_dir:_0xc3e890,match:_0x2880fd}=_0x57dec7[_0x2f38a7(0x147)];if(!_0x3696ff||!_0x2882f4||!_0x1b05b9||!_0xc3e890)throw new Error(_0x2f38a7(0x150));const _0x3df78b=path['join'](_0xc3e890,_0x3696ff,_0x2882f4),_0x355f5=path[_0x2f38a7(0x15d)](_0xc3e890,_0x1b05b9,_0x2882f4);!fs[_0x2f38a7(0x113)](path[_0x2f38a7(0x121)](_0x355f5))&&await fs[_0x2f38a7(0x133)][_0x2f38a7(0x11c)](path['dirname'](_0x355f5),{'recursive':!![]}),await fs[_0x2f38a7(0x133)][_0x2f38a7(0x115)](_0x3df78b,_0x355f5),console[_0x2f38a7(0x11e)](_0x2f38a7(0x13e)+_0x2882f4+'\x20从\x20'+_0x3696ff+_0x2f38a7(0x114)+_0x1b05b9),_0x3c4305['json']({'success':!![],'message':_0x2f38a7(0x140)+_0x2882f4+'\x20从\x20'+_0x3696ff+_0x2f38a7(0x114)+_0x1b05b9,'data':{'original_dir':_0xc3e890,'folderName':_0x3696ff,'fileName':_0x2882f4,'new_folderName':_0x1b05b9}});}catch(_0x1f364f){_0x12934b(_0x1f364f);}}),app[a0_0x35237b(0x152)]('/tgz_download',async(_0x50903d,_0x5d2ef1,_0x311518)=>{const _0x41b7e8=a0_0x35237b;try{const {directoryName:_0xb7cdaa,selectedFile:_0x41f22c,original_dir:_0x595073}=_0x50903d[_0x41b7e8(0x158)];if(!_0xb7cdaa||!_0x595073)throw new Error(_0x41b7e8(0x150));const _0xb642ef=_0xb7cdaa+_0x41b7e8(0x134),_0x46b441=path[_0x41b7e8(0x15d)](_0x595073,_0xb7cdaa);if(!fs[_0x41b7e8(0x113)](_0x46b441))throw new Error(_0x41b7e8(0x13c)+_0xb7cdaa+_0x41b7e8(0x111));if(_0x41f22c&&!fs[_0x41b7e8(0x113)](path[_0x41b7e8(0x15d)](_0x595073,_0x41f22c)))throw new Error(_0x41b7e8(0x15b)+_0x41f22c+'\x20不存在');_0x5d2ef1[_0x41b7e8(0x14f)](_0x41b7e8(0x142),_0x41b7e8(0x13f)),_0x5d2ef1[_0x41b7e8(0x14f)]('Content-Disposition','attachment;\x20filename=\x22'+encodeURIComponent(_0xb642ef)+'\x22');const _0x2e0ff6=tar[_0x41b7e8(0x15a)]({'gzip':!![]},_0x41f22c?[_0xb7cdaa,_0x41f22c]:[_0xb7cdaa]);_0x2e0ff6['pipe'](_0x5d2ef1);}catch(_0x186863){_0x311518(_0x186863);}}),app['use'](errorHandler),app['listen'](CONFIG[a0_0x35237b(0x135)],()=>{const _0x769d44=a0_0x35237b;console[_0x769d44(0x11e)](_0x769d44(0x143)+CONFIG['PORT']);});