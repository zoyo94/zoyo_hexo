const a0_0x3e1123=a0_0x2ee7;(function(_0x4f27ef,_0x35d8b8){const _0x5bc34b=a0_0x2ee7,_0x5d2618=_0x4f27ef();while(!![]){try{const _0x4c97a6=parseInt(_0x5bc34b(0x133))/0x1+parseInt(_0x5bc34b(0x128))/0x2*(-parseInt(_0x5bc34b(0x151))/0x3)+parseInt(_0x5bc34b(0x112))/0x4*(-parseInt(_0x5bc34b(0x144))/0x5)+-parseInt(_0x5bc34b(0x125))/0x6*(-parseInt(_0x5bc34b(0x123))/0x7)+parseInt(_0x5bc34b(0x11b))/0x8*(-parseInt(_0x5bc34b(0x124))/0x9)+parseInt(_0x5bc34b(0x10c))/0xa*(parseInt(_0x5bc34b(0x11d))/0xb)+parseInt(_0x5bc34b(0x109))/0xc;if(_0x4c97a6===_0x35d8b8)break;else _0x5d2618['push'](_0x5d2618['shift']());}catch(_0x3d3cb0){_0x5d2618['push'](_0x5d2618['shift']());}}}(a0_0x3301,0x32450));const express=require('express'),multer=require(a0_0x3e1123(0x143)),fs=require('fs'),path=require(a0_0x3e1123(0x139)),cors=require(a0_0x3e1123(0x12e)),crypto=require(a0_0x3e1123(0x137)),tar=require(a0_0x3e1123(0x13f)),workDir=__dirname+a0_0x3e1123(0x158);process[a0_0x3e1123(0x130)](workDir);const app=express();app[a0_0x3e1123(0x122)](cors());function a0_0x3301(){const _0x4a524b=['/save_md','files','25492YLCNkQ','set','writeFile','length','toLowerCase','/upimg','isDirectory','文件上传失败.','body','24avQlHV','memoryStorage','319jXIWvq','replace','buffer','Content-Disposition','post','use','16723amDTdn','593613mzEUza','228JZwnAl','single','Content-Type','2sbHeKZ','send','readdir','binary','mkdir','移动至','cors','test','chdir','extname','listen','13965arIEwf','md_editor/public/uploads/','status','mkdirSync','crypto','\x20不存在','path','log','original_dir','join','map','directory','tar','filename','utf-8','md文件上传成功.','multer','65sNXvqi','/move_image','缺少必要参数','/create_folder','缺少原点目录','/tgz_download','existsSync','lastIndexOf','文件写入失败','上传的文件不符.','push','name','attachment;\x20filename=\x22','195066pZIPLm','/directory-tree','获取目录树失败','selectedFile','substring','/upload','originalname','/public/uploads/','folderName','缺少需要打包的文件夹名','文件写入成功❤️','array','服务监听的端口为\x203001','Error\x20moving\x20image','from','query','destination','catch','then','create','创建目录失败','.tar','rename','图片上传成功❤️','toString','currentContent','pipe','error','json','1082040VvBKNZ','application/octet-stream','get','123010RgMoWQ','file','文件\x20','Image\x20moved\x20successfully❤️,已经把'];a0_0x3301=function(){return _0x4a524b;};return a0_0x3301();}function a0_0x2ee7(_0x136b2c,_0x5c2807){const _0x33012b=a0_0x3301();return a0_0x2ee7=function(_0x2ee753,_0x20f514){_0x2ee753=_0x2ee753-0xf4;let _0x53d4ea=_0x33012b[_0x2ee753];return _0x53d4ea;},a0_0x2ee7(_0x136b2c,_0x5c2807);}const upload=multer({'storage':multer[a0_0x3e1123(0x11c)](),'limits':{'fileSize':0x400*0x400*0x5},'fileFilter':function(_0x2efba0,_0x4ad485,_0x49bee8){const _0x61b0a8=a0_0x3e1123,_0x56b5f9=/md/,_0x50c8a9=_0x56b5f9[_0x61b0a8(0x12f)](path[_0x61b0a8(0x131)](_0x4ad485[_0x61b0a8(0x157)])[_0x61b0a8(0x116)]());_0x50c8a9?_0x49bee8(null,!![]):_0x49bee8(new Error(_0x61b0a8(0x14d)));}});app[a0_0x3e1123(0x121)](a0_0x3e1123(0x156),upload[a0_0x3e1123(0x126)]('md_file'),(_0x1a2631,_0x285496)=>{const _0x34979e=a0_0x3e1123,_0x2707aa=_0x34979e(0x134),_0x1ef11f=_0x1a2631['file'];if(!_0x1ef11f){_0x285496['status'](0x190)[_0x34979e(0x108)]({'success':![],'message':'No\x20file\x20uploaded.'});return;}const _0x4cfc8c=_0x1ef11f[_0x34979e(0x157)],_0x1addfa=_0x4cfc8c[_0x34979e(0x11e)](/\s/g,'_'),_0x37f40d=path['join'](workDir,_0x1addfa);fs['writeFile'](_0x37f40d,_0x1ef11f['buffer'],function(_0x5493bc){const _0x41bd3a=_0x34979e;_0x5493bc?(console['error'](_0x5493bc),_0x285496[_0x41bd3a(0x135)](0x1f4)[_0x41bd3a(0x108)]({'success':![],'message':_0x41bd3a(0x119)})):_0x285496[_0x41bd3a(0x108)]({'success':!![],'message':_0x41bd3a(0x142),'filePath':_0x37f40d,'filename':_0x1addfa,'destination':_0x2707aa});});});const upimg=multer({'storage':multer['memoryStorage'](),'limits':{'fileSize':0x400*0x400*0x32}});app['post'](a0_0x3e1123(0x117),upimg[a0_0x3e1123(0xf7)]('image'),(_0x47bd6a,_0x14d863)=>{const _0x1f4c05=a0_0x3e1123,_0xa3b0ee=_0x47bd6a['body'][_0x1f4c05(0xfc)];let _0xb8d9e0=[],_0x44da5e=[];for(let _0x1ba3b8=0x0;_0x1ba3b8<_0x47bd6a[_0x1f4c05(0x111)][_0x1f4c05(0x115)];_0x1ba3b8++){const _0x403fb0=_0x47bd6a['files'][_0x1ba3b8],_0x54ce09=_0x403fb0[_0x1f4c05(0x157)];let _0x3fd8f3=Buffer[_0x1f4c05(0xfa)](_0x54ce09,_0x1f4c05(0x12b))[_0x1f4c05(0x104)](_0x1f4c05(0x141))['replace'](/\s/g,'_');const _0x5d39af=_0x3fd8f3[_0x1f4c05(0x14b)]('.');if(_0x5d39af>0x0){const _0x28dc5c=_0x3fd8f3[_0x1f4c05(0x155)](0x0,_0x5d39af)[_0x1f4c05(0x11e)](/\./g,'_'),_0x446f16=_0x3fd8f3['substring'](_0x5d39af+0x1);_0x3fd8f3=_0x28dc5c+'.'+_0x446f16;}const _0x1323a7=''+_0xa3b0ee+_0x3fd8f3;fs['writeFile'](_0x1323a7,_0x403fb0[_0x1f4c05(0x11f)],function(_0x225c93){const _0x4c3527=_0x1f4c05;_0x225c93?(console[_0x4c3527(0x107)](_0x225c93),_0x14d863['status'](0x1f4)[_0x4c3527(0x108)]({'success':![],'message':_0x4c3527(0x14c)})):(_0xb8d9e0['push'](_0x1323a7),_0x44da5e[_0x4c3527(0x14e)](_0x3fd8f3),_0x1ba3b8===_0x47bd6a[_0x4c3527(0x111)][_0x4c3527(0x115)]-0x1&&_0x14d863['json']({'success':!![],'message':_0x4c3527(0x103),'imagePaths':_0xb8d9e0,'filenames':_0x44da5e,'destination':_0xa3b0ee}));});}});function readDirectory(_0x4a90da){return new Promise((_0x5e82b7,_0x5dee7d)=>{const _0x4d470c=a0_0x2ee7;fs[_0x4d470c(0x12a)](_0x4a90da,{'withFileTypes':!![]},(_0x43efff,_0x28d848)=>{const _0x21f867=_0x4d470c;if(_0x43efff){_0x5dee7d(_0x43efff);return;}const _0x27c2f7=_0x28d848[_0x21f867(0x13d)](_0x2d5389=>{const _0x11cbc4=_0x21f867,_0x5365ea=path[_0x11cbc4(0x13c)](_0x4a90da,_0x2d5389['name']);return _0x2d5389[_0x11cbc4(0x118)]()?readDirectory(_0x5365ea)[_0x11cbc4(0xfe)](_0x1014ca=>({'name':_0x2d5389[_0x11cbc4(0x14f)],'children':_0x1014ca,'type':_0x11cbc4(0x13e)})):Promise['resolve']({'name':_0x2d5389[_0x11cbc4(0x14f)],'type':'file'});});Promise['all'](_0x27c2f7)[_0x21f867(0xfe)](_0xa1babb=>{_0x5e82b7({'name':path['basename'](_0x4a90da),'children':_0xa1babb});})[_0x21f867(0xfd)](_0x7653b5=>{_0x5dee7d(_0x7653b5);});});});}app['get'](a0_0x3e1123(0x152),(_0x5d6043,_0x1beb61)=>{const _0x1af829=a0_0x3e1123,_0x3834ce=_0x5d6043[_0x1af829(0xfb)][_0x1af829(0x13e)];if(!_0x3834ce){_0x1beb61[_0x1af829(0x135)](0x190)['json']({'error':_0x1af829(0x146)});return;}readDirectory(_0x3834ce)[_0x1af829(0xfe)](_0x30bb1b=>{const _0x4771d2=_0x1af829;_0x1beb61[_0x4771d2(0x108)](_0x30bb1b);})[_0x1af829(0xfd)](_0x15196c=>{const _0x5b2217=_0x1af829;console[_0x5b2217(0x107)](_0x15196c),_0x1beb61['status'](0x1f4)[_0x5b2217(0x108)]({'error':_0x5b2217(0x153)});});});const save_md=multer({'storage':multer[a0_0x3e1123(0x11c)]()});app[a0_0x3e1123(0x121)](a0_0x3e1123(0x110),save_md[a0_0x3e1123(0x126)](a0_0x3e1123(0x10d)),(_0x4d029d,_0x2fdeba)=>{const _0x13e2bb=a0_0x3e1123,_0x3c9bad=_0x4d029d[_0x13e2bb(0x11a)][_0x13e2bb(0xfc)],_0x4d6fd6=_0x4d029d[_0x13e2bb(0x11a)][_0x13e2bb(0x140)],_0x113723=decodeURIComponent(_0x4d6fd6),_0x326288=_0x4d029d[_0x13e2bb(0x11a)][_0x13e2bb(0x105)];fs[_0x13e2bb(0x114)](_0x3c9bad+_0x113723,_0x326288,function(_0x354023){const _0x316411=_0x13e2bb;_0x354023?(console[_0x316411(0x107)](_0x354023),_0x2fdeba[_0x316411(0x135)](0x1f4)[_0x316411(0x108)]({'success':![],'message':_0x316411(0x14c)})):_0x2fdeba[_0x316411(0x108)]({'success':!![],'message':_0x316411(0xf6),'filepath':_0x113723});});});const create_folder=multer({'storage':multer['memoryStorage']()});app[a0_0x3e1123(0x121)](a0_0x3e1123(0x147),create_folder[a0_0x3e1123(0x126)]('file'),(_0x16bd02,_0x334b12)=>{const _0x5790f8=a0_0x3e1123,_0x415425=_0x16bd02[_0x5790f8(0x11a)]['folderPath'],_0x438186=_0x16bd02[_0x5790f8(0x11a)][_0x5790f8(0xf4)],_0x12aa42=path[_0x5790f8(0x13c)](_0x415425,_0x438186);fs[_0x5790f8(0x14a)](_0x12aa42)?_0x334b12[_0x5790f8(0x135)](0x1f4)[_0x5790f8(0x108)]({'success':![],'message':'目录已存在'}):fs[_0x5790f8(0x12c)](_0x12aa42,function(_0x290ec8){const _0x5b65a3=_0x5790f8;_0x290ec8?(console[_0x5b65a3(0x107)](_0x290ec8),_0x334b12[_0x5b65a3(0x135)](0x1f4)[_0x5b65a3(0x108)]({'success':![],'message':_0x5b65a3(0x100)})):_0x334b12[_0x5b65a3(0x108)]({'success':!![],'message':'目录创建成功❤️','folderpath':_0x12aa42});});});const move_image=multer({'storage':multer[a0_0x3e1123(0x11c)]()});app[a0_0x3e1123(0x121)](a0_0x3e1123(0x145),move_image[a0_0x3e1123(0x126)](a0_0x3e1123(0x10d)),(_0x24460e,_0x1c6b32)=>{const _0x2939b1=a0_0x3e1123,{folderName:_0x497dac,fileName:_0x515715,new_folderName:_0x45b46b,original_dir:_0x37ecd0,match:_0x7860bc}=_0x24460e[_0x2939b1(0x11a)],_0x4a74af=JSON['parse'](_0x7860bc);!fs[_0x2939b1(0x14a)](_0x45b46b)&&fs[_0x2939b1(0x136)](_0x45b46b);const _0x22c4bb=path['join'](_0x37ecd0,_0x497dac,_0x515715),_0x54f1f5=path[_0x2939b1(0x13c)](_0x37ecd0,_0x45b46b,_0x515715);fs[_0x2939b1(0x102)](_0x22c4bb,_0x54f1f5,_0x39d198=>{const _0x13ddfa=_0x2939b1;_0x39d198?(console[_0x13ddfa(0x107)](_0x39d198),_0x1c6b32[_0x13ddfa(0x135)](0x1f4)['send']({'success':![],'error':_0x13ddfa(0xf9)})):(console[_0x13ddfa(0x13a)]('已经把'+_0x515715+'从'+workDir+_0x497dac+_0x13ddfa(0x12d)+workDir+_0x45b46b),_0x1c6b32[_0x13ddfa(0x129)]({'success':!![],'__dirname':__dirname,'message':_0x13ddfa(0x10f)+_0x515715+'从'+workDir+_0x497dac+_0x13ddfa(0x12d)+workDir+_0x45b46b,'data':{'__dirname':__dirname,'original_dir':_0x37ecd0,'folderName':_0x497dac,'fileName':_0x515715,'match':_0x7860bc,'new_folderName':_0x45b46b}}));});}),app[a0_0x3e1123(0x10b)](a0_0x3e1123(0x149),(_0xd33ab2,_0xf12e20)=>{const _0x5de4bc=a0_0x3e1123;try{const _0x5198cb=_0xd33ab2[_0x5de4bc(0xfb)]['directoryName'];if(!_0x5198cb)throw new Error(_0x5de4bc(0xf5));const _0x4d6025=_0xd33ab2[_0x5de4bc(0xfb)][_0x5de4bc(0x13b)];if(!_0x4d6025)throw new Error(_0x5de4bc(0x148));const _0x528236=_0xd33ab2[_0x5de4bc(0xfb)][_0x5de4bc(0x154)],_0x185340=_0x5198cb+_0x5de4bc(0x101),_0x1f4587=encodeURIComponent(_0x185340);if(!fs['existsSync'](_0x5198cb))throw new Error('文件夹\x20'+_0x5198cb+_0x5de4bc(0x138));if(_0x528236&&!fs['existsSync'](_0x528236))throw new Error(_0x5de4bc(0x10e)+_0x528236+_0x5de4bc(0x138));const _0x444872=tar[_0x5de4bc(0xff)]({'gzip':!![]},_0x528236?[_0x5198cb,_0x528236]:[_0x5198cb]);_0xf12e20[_0x5de4bc(0x113)](_0x5de4bc(0x127),_0x5de4bc(0x10a)),_0xf12e20[_0x5de4bc(0x113)](_0x5de4bc(0x120),_0x5de4bc(0x150)+_0x1f4587+'\x22'),_0x444872[_0x5de4bc(0x106)](_0xf12e20);}catch(_0x3e9372){console['error'](_0x3e9372),_0xf12e20['status'](0x1f4)[_0x5de4bc(0x129)](_0x3e9372['message']);}}),app[a0_0x3e1123(0x132)](0xbb9,()=>{const _0x4899e7=a0_0x3e1123;console[_0x4899e7(0x13a)](_0x4899e7(0xf8));});