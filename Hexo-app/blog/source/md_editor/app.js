const a0_0x527ef0=a0_0x5347;(function(_0x1889d8,_0x42c999){const _0xee2278=a0_0x5347,_0x321191=_0x1889d8();while(!![]){try{const _0x5072a4=-parseInt(_0xee2278(0x149))/0x1*(-parseInt(_0xee2278(0x167))/0x2)+-parseInt(_0xee2278(0x162))/0x3+-parseInt(_0xee2278(0x136))/0x4*(-parseInt(_0xee2278(0x172))/0x5)+parseInt(_0xee2278(0x138))/0x6+parseInt(_0xee2278(0x17d))/0x7+-parseInt(_0xee2278(0x14e))/0x8*(parseInt(_0xee2278(0x184))/0x9)+-parseInt(_0xee2278(0x150))/0xa;if(_0x5072a4===_0x42c999)break;else _0x321191['push'](_0x321191['shift']());}catch(_0x3b563c){_0x321191['push'](_0x321191['shift']());}}}(a0_0x4dd2,0x59a98));const express=require(a0_0x527ef0(0x178)),multer=require(a0_0x527ef0(0x12f)),fs=require('fs'),path=require(a0_0x527ef0(0x148)),cors=require(a0_0x527ef0(0x164)),crypto=require(a0_0x527ef0(0x179)),tar=require(a0_0x527ef0(0x160)),workDir=__dirname+a0_0x527ef0(0x163);process[a0_0x527ef0(0x140)](workDir);function a0_0x5347(_0x1c5536,_0x3bba59){const _0x4dd2ba=a0_0x4dd2();return a0_0x5347=function(_0x53479c,_0x1b489e){_0x53479c=_0x53479c-0x129;let _0x2e69f2=_0x4dd2ba[_0x53479c];return _0x2e69f2;},a0_0x5347(_0x1c5536,_0x3bba59);}const app=express();app[a0_0x527ef0(0x16d)](cors());const upload=multer({'storage':multer[a0_0x527ef0(0x17a)](),'limits':{'fileSize':0x400*0x400*0x5},'fileFilter':function(_0x2430d7,_0x23d594,_0x43f54f){const _0x12b4d5=a0_0x527ef0,_0xc59687=/md/,_0x4c1b26=_0xc59687[_0x12b4d5(0x134)](path[_0x12b4d5(0x145)](_0x23d594[_0x12b4d5(0x174)])['toLowerCase']());_0x4c1b26?_0x43f54f(null,!![]):_0x43f54f(new Error(_0x12b4d5(0x137)));}});app[a0_0x527ef0(0x13f)](a0_0x527ef0(0x17e),upload[a0_0x527ef0(0x13e)](a0_0x527ef0(0x133)),(_0x1b039d,_0x28ca00)=>{const _0x24ecbd=a0_0x527ef0,_0x5a6c47='md_editor/public/uploads/',_0x3b6d29=_0x1b039d[_0x24ecbd(0x159)];if(!_0x3b6d29){_0x28ca00['status'](0x190)[_0x24ecbd(0x173)]({'success':![],'message':'No\x20file\x20uploaded.'});return;}const _0x4ed6f7=_0x3b6d29[_0x24ecbd(0x174)],_0x32d3bf=Buffer['from'](_0x4ed6f7,_0x24ecbd(0x186))['toString'](_0x24ecbd(0x15c));fs[_0x24ecbd(0x12e)](_0x5a6c47+_0x32d3bf,_0x3b6d29[_0x24ecbd(0x141)],function(_0xd39a27){const _0x5aa630=_0x24ecbd;if(_0xd39a27)console[_0x5aa630(0x130)](_0xd39a27),_0x28ca00['status'](0x1f4)['json']({'success':![],'message':_0x5aa630(0x12d)});else{const _0xaede96=''+_0x5a6c47+_0x32d3bf;_0x28ca00['json']({'success':!![],'message':_0x5aa630(0x17b),'filePath':_0xaede96,'filename':_0x32d3bf,'destination':_0x5a6c47});}});});const upimg=multer({'storage':multer[a0_0x527ef0(0x17a)](),'limits':{'fileSize':0x400*0x400*0x32}});app[a0_0x527ef0(0x13f)](a0_0x527ef0(0x175),upimg[a0_0x527ef0(0x144)]('image'),(_0x360634,_0x116f9b)=>{const _0x60b327=a0_0x527ef0,_0x395c39=_0x360634['body'][_0x60b327(0x14f)];let _0x1183df=[],_0x21ca62=[];for(let _0x3ef310=0x0;_0x3ef310<_0x360634['files'][_0x60b327(0x12a)];_0x3ef310++){const _0x3583bb=_0x360634[_0x60b327(0x158)][_0x3ef310],_0x151698=_0x3583bb['originalname'];let _0x54f0c9=Buffer[_0x60b327(0x16c)](_0x151698,_0x60b327(0x186))[_0x60b327(0x16a)]('utf-8')[_0x60b327(0x177)](/\s/g,'_');const _0x48da77=_0x54f0c9[_0x60b327(0x13a)]('.');if(_0x48da77>0x0){const _0xfe1451=_0x54f0c9[_0x60b327(0x18a)](0x0,_0x48da77)['replace'](/\./g,'_'),_0x1b0f5a=_0x54f0c9[_0x60b327(0x18a)](_0x48da77+0x1);_0x54f0c9=_0xfe1451+'.'+_0x1b0f5a;}const _0x3f5f94=''+_0x395c39+_0x54f0c9;fs[_0x60b327(0x12e)](_0x3f5f94,_0x3583bb['buffer'],function(_0x5ee56f){const _0x59d013=_0x60b327;_0x5ee56f?(console[_0x59d013(0x130)](_0x5ee56f),_0x116f9b['status'](0x1f4)[_0x59d013(0x173)]({'success':![],'message':_0x59d013(0x139)})):(_0x1183df[_0x59d013(0x143)](_0x3f5f94),_0x21ca62[_0x59d013(0x143)](_0x54f0c9),_0x3ef310===_0x360634[_0x59d013(0x158)][_0x59d013(0x12a)]-0x1&&_0x116f9b[_0x59d013(0x173)]({'success':!![],'message':'图片上传成功❤️','imagePaths':_0x1183df,'filenames':_0x21ca62,'destination':_0x395c39}));});}});function readDirectory(_0x1bd451){return new Promise((_0xbb7224,_0x42e4db)=>{fs['readdir'](_0x1bd451,{'withFileTypes':!![]},(_0x554cc9,_0x53ddf2)=>{const _0x274280=a0_0x5347;if(_0x554cc9){_0x42e4db(_0x554cc9);return;}const _0x3da8db=_0x53ddf2[_0x274280(0x157)](_0x3a746b=>{const _0x9d87e0=_0x274280,_0x4a9cfc=path[_0x9d87e0(0x176)](_0x1bd451,_0x3a746b[_0x9d87e0(0x16e)]);return _0x3a746b[_0x9d87e0(0x188)]()?readDirectory(_0x4a9cfc)[_0x9d87e0(0x183)](_0x204b34=>({'name':_0x3a746b[_0x9d87e0(0x16e)],'children':_0x204b34,'type':_0x9d87e0(0x185)})):Promise['resolve']({'name':_0x3a746b[_0x9d87e0(0x16e)],'type':_0x9d87e0(0x159)});});Promise[_0x274280(0x161)](_0x3da8db)[_0x274280(0x183)](_0x3b6717=>{const _0x53962d=_0x274280;_0xbb7224({'name':path[_0x53962d(0x131)](_0x1bd451),'children':_0x3b6717});})[_0x274280(0x151)](_0x1667ad=>{_0x42e4db(_0x1667ad);});});});}app['get'](a0_0x527ef0(0x142),(_0x4b1ec3,_0x30d60b)=>{const _0x24a7d1=a0_0x527ef0,_0x562f3e=_0x4b1ec3['query']['directory'];if(!_0x562f3e){_0x30d60b['status'](0x190)[_0x24a7d1(0x173)]({'error':_0x24a7d1(0x166)});return;}readDirectory(_0x562f3e)[_0x24a7d1(0x183)](_0x58dada=>{const _0x250b69=_0x24a7d1;_0x30d60b[_0x250b69(0x173)](_0x58dada);})[_0x24a7d1(0x151)](_0x496d2e=>{const _0x28582e=_0x24a7d1;console[_0x28582e(0x130)](_0x496d2e),_0x30d60b[_0x28582e(0x155)](0x1f4)[_0x28582e(0x173)]({'error':'获取目录树失败'});});});const save_md=multer({'storage':multer[a0_0x527ef0(0x17a)]()});app[a0_0x527ef0(0x13f)]('/save_md',save_md[a0_0x527ef0(0x13e)]('file'),(_0x53ce1e,_0x30cc68)=>{const _0x530d1b=a0_0x527ef0,_0x2644b4=_0x53ce1e[_0x530d1b(0x17f)][_0x530d1b(0x14f)],_0x39ba31=_0x53ce1e['body'][_0x530d1b(0x15b)],_0x9ea10a=decodeURIComponent(_0x39ba31),_0x3d88bb=_0x53ce1e['body']['currentContent'];fs[_0x530d1b(0x12e)](_0x2644b4+_0x9ea10a,_0x3d88bb,function(_0x5c648a){const _0x3435ca=_0x530d1b;_0x5c648a?(console[_0x3435ca(0x130)](_0x5c648a),_0x30cc68['status'](0x1f4)[_0x3435ca(0x173)]({'success':![],'message':_0x3435ca(0x139)})):_0x30cc68['json']({'success':!![],'message':_0x3435ca(0x168),'filepath':_0x9ea10a});});});const create_folder=multer({'storage':multer[a0_0x527ef0(0x17a)]()});app['post'](a0_0x527ef0(0x181),create_folder[a0_0x527ef0(0x13e)](a0_0x527ef0(0x159)),(_0x3e9bc8,_0x29954e)=>{const _0xebe359=a0_0x527ef0,_0x3473d5=_0x3e9bc8[_0xebe359(0x17f)][_0xebe359(0x129)],_0x5467f3=_0x3e9bc8['body'][_0xebe359(0x132)],_0x27ae12=path['join'](_0x3473d5,_0x5467f3);fs[_0xebe359(0x17c)](_0x27ae12)?_0x29954e['status'](0x1f4)[_0xebe359(0x173)]({'success':![],'message':_0xebe359(0x180)}):fs[_0xebe359(0x182)](_0x27ae12,function(_0x3f65db){const _0x108020=_0xebe359;_0x3f65db?(console[_0x108020(0x130)](_0x3f65db),_0x29954e['status'](0x1f4)[_0x108020(0x173)]({'success':![],'message':_0x108020(0x147)})):_0x29954e[_0x108020(0x173)]({'success':!![],'message':_0x108020(0x13c),'folderpath':_0x27ae12});});});const move_image=multer({'storage':multer[a0_0x527ef0(0x17a)]()});app[a0_0x527ef0(0x13f)](a0_0x527ef0(0x135),move_image[a0_0x527ef0(0x13e)](a0_0x527ef0(0x159)),(_0x30122f,_0xd0e2d2)=>{const _0x46e5e4=a0_0x527ef0,{folderName:_0x383fc6,fileName:_0x3f0632,new_folderName:_0x557d28,original_dir:_0x4dd5d7,match:_0x38bb76}=_0x30122f[_0x46e5e4(0x17f)],_0x4fecf7=JSON[_0x46e5e4(0x187)](_0x38bb76);!fs[_0x46e5e4(0x17c)](_0x557d28)&&fs[_0x46e5e4(0x14d)](_0x557d28);const _0xc3d8b8=path[_0x46e5e4(0x176)](_0x4dd5d7,_0x383fc6,_0x3f0632),_0xb41d43=path[_0x46e5e4(0x176)](_0x4dd5d7,_0x557d28,_0x3f0632);fs[_0x46e5e4(0x15a)](_0xc3d8b8,_0xb41d43,_0xf76ab8=>{const _0x27f87a=_0x46e5e4;_0xf76ab8?(console[_0x27f87a(0x130)](_0xf76ab8),_0xd0e2d2['status'](0x1f4)[_0x27f87a(0x146)]({'success':![],'error':_0x27f87a(0x15e)})):(console[_0x27f87a(0x15f)](_0x27f87a(0x189)+_0x3f0632+'从'+workDir+_0x383fc6+'移动至'+workDir+_0x557d28),_0xd0e2d2[_0x27f87a(0x146)]({'success':!![],'__dirname':__dirname,'message':'Image\x20moved\x20successfully❤️,已经把'+_0x3f0632+'从'+workDir+_0x383fc6+_0x27f87a(0x14b)+workDir+_0x557d28,'data':{'__dirname':__dirname,'original_dir':_0x4dd5d7,'folderName':_0x383fc6,'fileName':_0x3f0632,'match':_0x38bb76,'new_folderName':_0x557d28}}));});}),app[a0_0x527ef0(0x14a)](a0_0x527ef0(0x171),(_0x10ea63,_0x23d5c9)=>{const _0x12126c=a0_0x527ef0;try{const _0x7d2b7b=_0x10ea63['query'][_0x12126c(0x165)];if(!_0x7d2b7b)throw new Error(_0x12126c(0x152));const _0x13597e=_0x10ea63['query'][_0x12126c(0x156)];if(!_0x13597e)throw new Error('缺少原点目录');const _0xed693=_0x10ea63[_0x12126c(0x18b)][_0x12126c(0x169)],_0x53e6c9=_0x7d2b7b+'.tar',_0x184651=encodeURIComponent(_0x53e6c9);if(!fs[_0x12126c(0x17c)](_0x7d2b7b))throw new Error('文件夹\x20'+_0x7d2b7b+_0x12126c(0x12c));if(_0xed693&&!fs[_0x12126c(0x17c)](_0xed693))throw new Error(_0x12126c(0x153)+_0xed693+_0x12126c(0x12c));const _0x2f72f7=tar[_0x12126c(0x154)]({'gzip':!![]},_0xed693?[_0x7d2b7b,_0xed693]:[_0x7d2b7b]);_0x23d5c9[_0x12126c(0x13b)]('Content-Type',_0x12126c(0x16b)),_0x23d5c9[_0x12126c(0x13b)](_0x12126c(0x16f),_0x12126c(0x15d)+_0x184651+'\x22'),_0x2f72f7[_0x12126c(0x170)](_0x23d5c9);}catch(_0x398b2b){console[_0x12126c(0x130)](_0x398b2b),_0x23d5c9[_0x12126c(0x155)](0x1f4)[_0x12126c(0x146)](_0x398b2b[_0x12126c(0x14c)]);}}),app[a0_0x527ef0(0x13d)](0xbb9,()=>{const _0x27872a=a0_0x527ef0;console[_0x27872a(0x15f)](_0x27872a(0x12b));});function a0_0x4dd2(){const _0x25425a=['json','originalname','/upimg','join','replace','express','crypto','memoryStorage','md文件上传成功.','existsSync','1318632FOynEW','/upload','body','目录已存在','/create_folder','mkdir','then','117bqLDcR','directory','binary','parse','isDirectory','已经把','substring','query','folderPath','length','服务监听的端口为\x203001','\x20不存在','File\x20upload\x20failed.','writeFile','multer','error','basename','folderName','md_file','test','/move_image','364084gaRDYQ','上传的文件不符.','765582HHBKTF','文件写入失败','lastIndexOf','set','目录创建成功❤️','listen','single','post','chdir','buffer','/directory-tree','push','array','extname','send','创建目录失败','path','1OoVegW','get','移动至','message','mkdirSync','372560Byvzpf','destination','381270FqdRxS','catch','缺少需要打包的文件夹名','文件\x20','create','status','original_dir','map','files','file','rename','filename','utf-8','attachment;\x20filename=\x22','Error\x20moving\x20image','log','tar','all','62712LlmPAD','/public/uploads/','cors','directoryName','缺少必要参数','885322MxRCTP','文件写入成功❤️','selectedFile','toString','application/octet-stream','from','use','name','Content-Disposition','pipe','/tgz_download','15dFbLxy'];a0_0x4dd2=function(){return _0x25425a;};return a0_0x4dd2();}